"use strict";(self.webpackChunk_wintercms_wn_backend_module=self.webpackChunk_wintercms_wn_backend_module||[]).push([[989],{617:function(){class t{constructor(t,e){this.widget=t,this.editor=e,this.button=null}bindButton(t){this.button=t}icon(){return"location-crosshairs"}tooltip(){return null}shortcutKey(){return null}status(){return null}isDropdown(){return!1}dropdownItems(){return[]}isActive(){return!1}isEnabled(){return!1}action(){}}class e extends t{icon(){return"bold"}tooltip(){return"Bold"}shortcutKey(){return"B"}isActive(){return!(!this.editor||!this.editor.getModel())&&(this.isCurrentWordBold()||this.isCurrentSelectionBold())}isEnabled(){return!0}action(){if(this.editor.getSelection().isEmpty()){const t=this.selectCurrentWord();if(t&&this.isCurrentWordBold())return this.editor.getEditor().setSelection({startLineNumber:t.selection.startLineNumber,startColumn:t.selection.startColumn-2,endLineNumber:t.selection.endLineNumber,endColumn:t.selection.endColumn+2}),this.editor.unwrap("**","**"),void this.editor.focus();t&&!this.isCurrentWordBold()&&this.editor.getEditor().setSelection(t.selection)}else if(this.isCurrentSelectionBold()){const t=this.editor.getSelection();return this.editor.getEditor().setSelection({startLineNumber:t.startLineNumber,startColumn:t.startColumn-2,endLineNumber:t.endLineNumber,endColumn:t.endColumn+2}),this.editor.unwrap("**","**"),void this.editor.focus()}this.editor.wrap("**","**"),this.editor.focus()}selectCurrentWord(){const t=this.editor.getSelection(),e=this.editor.getModel().getValueInRange(t);if(t.startLineNumber!==t.endLineNumber||e.includes(" "))return null;const i=this.editor.getPosition(),o=this.editor.getModel().getWordAtPosition(i);return o?{word:o.word,selection:{startLineNumber:i.lineNumber,startColumn:o.startColumn,endLineNumber:i.lineNumber,endColumn:o.endColumn}}:null}isCurrentWordBold(){const t=this.selectCurrentWord();if(!t)return!1;const e=this.editor.getModel().getLineLength(t.selection.startLineNumber);if(t.selection.startColumn<3)return!1;if(t.selection.endColumn>e-1)return!1;const i=this.editor.getModel().getValueInRange({startLineNumber:t.selection.startLineNumber,startColumn:t.selection.startColumn-2,endLineNumber:t.selection.endLineNumber,endColumn:t.selection.endColumn+2});return!(!i.startsWith("**")||!i.endsWith("**"))}isCurrentSelectionBold(){const t=this.editor.getSelection();if(t.startLineNumber!==t.endLineNumber)return!1;const e=this.editor.getModel().getLineLength(t.startLineNumber);if(t.startColumn<3)return!1;if(t.endColumn>e-1)return!1;const i=this.editor.getModel().getValueInRange({startLineNumber:t.startLineNumber,startColumn:t.startColumn-2,endLineNumber:t.endLineNumber,endColumn:t.endColumn+2});return!(!i.startsWith("**")||!i.endsWith("**"))}}(t=>{class i extends t.PluginBase{construct(t){this.element=t,this.toolbar=t.querySelector(".markdowneditor-toolbar"),this.editorElement=t.querySelector(".markdowneditor-editor"),this.preview=t.querySelector(".markdowneditor-preview"),this.config=this.snowboard.dataConfig(this,this.element),this.editor=null,this.actions=[],this.events={value:t=>this.updatePreview(t)},this.createEditor(),this.registerActions(),this.createToolbar()}defaults(){return{refreshHandler:null,useMediaManager:!1}}destruct(){this.editor&&(this.editor.events.off("input",this.events.value),this.editor.destruct())}dependencies(){return["backend.formwidgets.codeeditor"]}createEditor(){this.editor=this.snowboard["backend.formwidgets.codeeditor"](this.editorElement),this.editor.loadTheme("chrome"),this.editor.setConfig("fontSize",14),this.editor.setConfig("showGutter",!1),this.editor.setConfig("showMinimap",!1),this.editor.setConfig("showColors",!1),this.editor.setConfig("displayIndentGuides",!1),this.editor.setConfig("codeFolding",!1),this.editor.events.once("create",(()=>{this.editor.setLanguage("markdown")})),this.editor.events.on("input",this.events.value),this.editor.events.on("position",(()=>{this.updateToolbarButtonStates()})),this.editor.events.on("selection",(()=>{this.updateToolbarButtonStates()}))}updatePreview(t){this.snowboard.request(this.config.get("refreshHandler"),{data:{content:t},success:t=>{this.preview.innerHTML=t.preview}})}registerActions(){this.actions.push({name:"bold",action:new e(this,this.editor)})}findAction(t){const e=this.actions.find((e=>e.name===t));return e?e.action:null}createToolbar(){this.toolbar.children.length&&this.toolbar.children.forEach((t=>{t.remove()})),this.actions.forEach((t=>{this.toolbar.appendChild(this.createToolbarButton(t))}))}createToolbarButton(t){let{name:e,action:i}=t;const o=document.createElement("button");o.dataset.action=e,i.isActive()&&o.classList.add("active"),i.isDropdown()&&o.classList.add("dropdown"),o.disabled=!i.isEnabled();const n=document.createElement("i");if(n.classList.add(`icon-${i.icon()}`),o.appendChild(n),i.status()){const t=document.createElement("span");t.classList.add("status"),t.innerText=i.status(),o.appendChild(t)}if(i.bindButton(o),i.dropdownItems().length){const t=document.createElement("div");t.classList.add("dropdown");const e=document.createElement("ul");return e.classList.add("dropdown-menu"),e.setAttribute("role","menu"),this.generateDropdownItems(i,e),t.appendChild(o),t.appendChild(e),i.tooltip()&&(t.classList.add("has-tooltip"),t.setAttribute("data-toggle","tooltip"),t.setAttribute("title",i.tooltip()),i.shortcutKey()&&t.setAttribute("title",`${t.getAttribute("title")} (${this.getModifierKey()}${i.shortcutKey()})`)),o.setAttribute("data-toggle","dropdown"),t}return i.tooltip()&&(o.classList.add("has-tooltip"),o.setAttribute("data-toggle","tooltip"),o.setAttribute("title",i.tooltip()),i.shortcutKey()&&o.setAttribute("title",`${o.getAttribute("title")} (${this.getModifierKey()}${i.shortcutKey()})`)),o.addEventListener("click",(t=>{t.preventDefault(),t.stopImmediatePropagation(),i.action(),this.updateToolbarButtonStates()})),o}generateDropdownItems(t,e){t.dropdownItems().length&&t.dropdownItems().forEach((t=>{const i=document.createElement("li");i.setAttribute("role","presentation"),t.active&&i.classList.add("active"),t.enabled||i.classList.add("disabled");const o=document.createElement("a");o.setAttribute("role","menuitem"),o.setAttribute("href","#"),t.icon&&o.classList.add(`wn-icon-${t.icon}`),t.label&&(o.innerText=t.label),t.enabled&&o.addEventListener("click",(e=>{e.preventDefault(),t.action(),this.updateToolbarButtonStates()})),i.appendChild(o),e.appendChild(i)}))}updateToolbarButtonStates(){this.toolbar.querySelectorAll("button[data-action]").forEach((t=>{const e=this.findAction(t.dataset.action);if(e){if(t.querySelector("i").className=`icon-${e.icon()}`,e.status()){let i=t.querySelector(".status");i||(i=document.createElement("span"),i.classList.add("status"),t.appendChild(i)),i.innerText=e.status()}else t.querySelector(".status")&&t.querySelector(".status").remove();if(e.dropdownItems().length){let i=t.parentElement;i.classList.contains("dropdown")||(i=document.createElement("div"),i.classList.add("dropdown")),i.querySelector("ul")&&i.querySelector("ul").remove();const o=document.createElement("ul");o.classList.add("dropdown-menu"),o.setAttribute("role","menu"),this.generateDropdownItems(e,o),i.appendChild(t),i.appendChild(o),e.tooltip()&&i.classList.contains("has-tooltip")&&(i.setAttribute("title",e.tooltip()),e.shortcutKey()&&i.setAttribute("title",`${i.getAttribute("title")} (${this.getModifierKey()}${e.shortcutKey()})`)),t.setAttribute("data-toggle","dropdown")}else e.tooltip()&&t.classList.contains("has-tooltip")&&(t.setAttribute("title",e.tooltip()),e.shortcutKey()&&t.setAttribute("title",`${t.getAttribute("title")} (${this.getModifierKey()}${e.shortcutKey()})`));t.disabled=!e.isEnabled(),e.isActive()?t.classList.add("active"):t.classList.remove("active")}}))}getModifierKey(){let t="^";return 0!==navigator.platform.indexOf("Mac")&&"iPhone"!==navigator.platform||(t="âŒ˜"),t}}t.addPlugin("backend.formwidgets.markdowneditor",i),t["backend.ui.widgetHandler"]().register("markdowneditor","backend.formwidgets.markdowneditor")})(window.Snowboard)}},function(t){var e;e=617,t(t.s=e)}]);