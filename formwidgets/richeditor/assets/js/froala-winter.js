var richeditorPageLinksPlugin;function richeditorPageLinksSelectPage(e){richeditorPageLinksPlugin.setLinkValueFromPopup(e)}!function(e){e.FroalaEditor.PLUGINS.figures=function(t){function i(i){var o=e("<div />").append(i.clone()).remove().html();t.events.focus(!0),t.selection.restore(),t.html.insert(o),t.html.cleanEmptyTags(),e("figure",t.$el).each((function(){var t=e(this),i=t.parent("p"),o=t.next("p");i.length&&t.insertAfter(i),o.length&&0==e.trim(o.text()).length&&o.remove()})),t.undo.saveStep()}function o(){var t=e('<figure contenteditable="false" tabindex="0" data-ui-block="true">&nbsp;</figure>');return t.get(0).contentEditable=!1,t}function n(){e("[data-video], [data-audio]",t.$el).each((function(){e(this).addClass("fr-draggable").attr({"data-ui-block":"true",draggable:"true",tabindex:"0"}).html("&nbsp;"),this.contentEditable=!1}))}function a(i,o){void 0!==i.attr("data-ui-block")&&0==e.trim(o.text()).length&&(o.remove(),r(i),t.undo.saveStep())}function r(e){return void 0!==e.attr("data-ui-block")&&(e.focus(),t.selection.clear(),!0)}function s(e,i){e.length&&(r(e)||(i?(t.selection.setAtStart(e.get(0)),t.selection.restore()):(t.selection.setAtEnd(e.get(0)),t.selection.restore())))}function l(i){if(function(i){if("ArrowDown"===i.key||"ArrowUp"===i.key||"Backspace"===i.key||"Delete"===i.key){var o=e(t.selection.element());if(o.is("br")&&(o=o.parent()),o.length)switch(i.key){case"ArrowUp":r(o.prev());break;case"ArrowDown":r(o.next());break;case"Delete":a(o.next(),o);break;case"Backspace":a(o.prev(),o)}}}(i),i.isDefaultPrevented())return!1}function d(i){if(i.target&&void 0!==e(i.target).attr("data-ui-block")&&function(i,o){if("ArrowDown"===i.key||"ArrowUp"===i.key||"Enter"===i.key||"Backspace"===i.key||"Delete"===i.key){switch(i.key){case"ArrowDown":s(e(o).next(),!0);break;case"ArrowUp":s(e(o).prev(),!1);break;case"Enter":e("<p><br/></p>").insertAfter(o),t.selection.setAfter(o),t.selection.restore(),t.undo.saveStep();break;case"Backspace":case"Delete":var n=e(o).next(),a=!0;0==n.length&&(n=e(o).prev(),a=!1),s(n,a),e(o).remove(),t.undo.saveStep()}i.preventDefault()}}(i,i.target),i.isDefaultPrevented())return!1}function c(t){var i=e("<div>"+t+"</div>");return i.find("[data-video], [data-audio]").each((function(){e(this).removeAttr("contenteditable data-ui-block tabindex draggable").removeClass("fr-draggable fr-dragging")})),i.html()}function p(){t.$el.off("keydown","figure",d)}return{_init:function(){t.events.on("initialized",n),t.events.on("html.set",n),t.events.on("html.get",c),t.events.on("keydown",l),t.events.on("destroy",p,!0),t.$el.on("keydown","figure",d)},insert:i,insertVideo:function(e,t){var n=o();n.attr("data-video",e),n.attr("data-label",t),i(n)},insertAudio:function(e,t){var n=o();n.attr("data-audio",e),n.attr("data-label",t),i(n)}}}}(jQuery),function(e){if(e.FroalaEditor.PLUGINS.mediaManager=function(t){function i(e){var i=t.$el.closest('[data-control="richeditor"]'),o=e.substring(e.lastIndexOf("/")+1);i.richEditor("insertVideo",e,o),t.popups.hide("video.insert")}function o(e){var i=t.$el.closest('[data-control="richeditor"]'),o=e.substring(e.lastIndexOf("/")+1);i.richEditor("insertAudio",e,o),t.popups.hide("audio.insert")}function n(){}return{_init:function(){t.events.on("destroy",n,!0),t.events.on("video.linkError",i),t.events.on("audio.linkError",o)},insertFile:function(){new e.wn.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!1,onInsert:function(i){if(i.length)if(i.length>1)e.wn.alert(e.wn.lang.get("mediamanager.invalid_file_single_insert"));else{for(var o,n=t.selection.text(),a=""===e.trim(n),r=0,s=i.length;r<s;r++){n=a?i[r].title:n;o=i[r].publicUrl}t.events.focus(!0),t.selection.restore(),t.html.insert('<a href="'+o+'" id="fr-inserted-file" class="fr-file">'+n+"</a>"),t.$el.find("#fr-inserted-file").removeAttr("id"),t.undo.saveStep(),this.hide()}else e.wn.alert(e.wn.lang.get("mediamanager.invalid_file_empty_insert"))}})},insertImage:function(){var i=t.image.get(),o=t.selection.get(),n=t.selection.ranges(0);new e.wn.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!0,onInsert:function(a){if(t.selection.clear(),o.addRange(n),a.length){for(var r=0,s=0,l=a.length;s<l;s++)"image"===a[s].documentType?(t.image.insert(a[s].publicUrl,!1,{},i),1==++r&&(i=null)):e.wn.alert(e.wn.lang.get("mediamanager.invalid_image_invalid_insert",'The file "'+a[s].title+'" is not an image.'));0!==r&&(this.hide(),t.undo.saveStep())}else e.wn.alert(e.wn.lang.get("mediamanager.invalid_image_empty_insert"))}})},insertVideo:function(){new e.wn.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!1,onInsert:function(i){if(i.length)if(i.length>1)e.wn.alert(e.wn.lang.get("mediamanager.invalid_file_single_insert"));else{var o=i[0];if("video"===o.documentType)t.$el.closest('[data-control="richeditor"]').richEditor("insertVideo",o.publicUrl,o.title),this.hide();else e.wn.alert(e.wn.lang.get("mediamanager.invalid_video_invalid_insert",'The file "'+o.title+'" is not a video.'))}else e.wn.alert(e.wn.lang.get("mediamanager.invalid_video_empty_insert"))}})},insertAudio:function(){new e.wn.mediaManager.popup({alias:"ocmediamanager",cropAndInsertButton:!1,onInsert:function(i){if(i.length)if(i.length>1)e.wn.alert(e.wn.lang.get("mediamanager.invalid_file_single_insert"));else{var o=i[0];if("audio"===o.documentType)t.$el.closest('[data-control="richeditor"]').richEditor("insertAudio",o.publicUrl,o.title),this.hide();else e.wn.alert(e.wn.lang.get("mediamanager.invalid_audio_invalid_insert",'The file "'+o.title+'" is not an audio file.'))}else e.wn.alert(e.wn.lang.get("mediamanager.invalid_audio_empty_insert"))}})}}},!(e.FE.PLUGINS.link&&e.FE.PLUGINS.file&&e.FE.PLUGINS.image&&e.FE.PLUGINS.video))throw new Error("Media manager plugin requires link, file, image and video plugin.");e.FE.DEFAULTS.imageInsertButtons.push("mmImageManager"),e.FE.RegisterCommand("mmImageManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertImage()},plugin:"mediaManager"}),e.FE.DefineIcon("mmImageManager",{NAME:"folder"}),e.FE.DEFAULTS.fileInsertButtons.push("mmFileManager"),e.FE.RegisterCommand("mmFileManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertFile()},plugin:"mediaManager"}),e.FE.DefineIcon("mmFileManager",{NAME:"folder"}),e.FE.DEFAULTS.videoInsertButtons.push("mmVideoManager"),e.FE.RegisterCommand("mmVideoManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertVideo()},plugin:"mediaManager"}),e.FE.DefineIcon("mmVideoManager",{NAME:"folder"}),e.FE.DEFAULTS.audioInsertButtons.push("mmAudioManager"),e.FE.RegisterCommand("mmAudioManager",{title:"Browse",undo:!1,focus:!1,callback:function(){this.mediaManager.insertAudio()},plugin:"mediaManager"}),e.FE.DefineIcon("mmAudioManager",{NAME:"folder"})}(jQuery),$.FroalaEditor.DEFAULTS=$.extend($.FroalaEditor.DEFAULTS,{pageLinksHandler:"onLoadPageLinksForm"}),$.FroalaEditor.DEFAULTS.key="JA6B2B5A1qB1F1F4D3I1A15A11D3E6B5dVh1VCQWa1EOQFe1NCb1==",function(e){e.FroalaEditor.PLUGINS.pageLinks=function(t){function i(i){var o,n,a=t.popups.get("link.insert"),r=a.find('input.fr-link-attr[type="text"]'),s=a.find('input.fr-link-attr[type="checkbox"]');for(n=0;n<r.length;n++){var l=(o=e(r[n])).attr("name"),d=i[l];"text"===l?0===o.val().length&&o.val(d):o.val(d)}for(n=0;n<s.length;n++)(o=e(s[n])).prop("checked",o.data("checked")==i[o.attr("name")]);t.selection.restore()}return{_init:function(){},setLinkValueFromPopup:function(o){var n=e("select[name=pagelink]",o),a={text:e("option:selected",n).text().trim(),href:n.val()};setTimeout((function(){t.popups.show("link.insert"),i(a)}),300)},setLinkValue:i,insertLink:function(){richeditorPageLinksPlugin=this,t.$el.popup({handler:t.opts.pageLinksHandler}).one("shown.oc.popup.pageLinks",(function(){t.selection.save()}))}}},e.FE.DEFAULTS.linkInsertButtons=["linkBack","|","linkPageLinks"],e.FE.RegisterCommand("linkPageLinks",{title:"Choose Link",undo:!1,focus:!1,callback:function(){this.pageLinks.insertLink()},plugin:"pageLinks"}),e.FE.DefineIcon("linkPageLinks",{NAME:"search"})}(jQuery),function(e){"use strict";var t=e.wn.foundation.base,i=t.prototype,o=function(i,o){this.options=o,this.$el=e(i),this.$textarea=this.$el.find(">textarea:first"),this.$form=this.$el.closest("form"),this.editor=null,e.wn.foundation.controlUtils.markDisposable(i),t.call(this),this.init()};(o.prototype=Object.create(i)).constructor=o,o.DEFAULTS={linksHandler:null,uploadHandler:null,stylesheet:null,fullpage:!1,editorLang:"en",useMediaManager:!1,toolbarButtons:null,allowEmptyTags:null,allowTags:null,allowAttributes:null,noWrapTags:null,removeTags:null,lineBreakerTags:null,imageStyles:null,linkStyles:null,paragraphStyles:null,paragraphFormat:null,tableStyles:null,tableCellStyles:null,aceVendorPath:"/",readOnly:!1},o.prototype.init=function(){this.$el.one("dispose-control",this.proxy(this.dispose)),this.$textarea.attr("id")||this.$textarea.attr("id","element-"+Math.random().toString(36).substring(7)),this.initFroala()},o.prototype.initFroala=function(){var t={editorClass:"control-richeditor",language:this.options.editorLang,fullPage:this.options.fullpage,pageLinksHandler:this.options.linksHandler,uploadHandler:this.options.uploadHandler,aceEditorVendorPath:this.options.aceVendorPath,toolbarSticky:!1};this.options.toolbarButtons?t.toolbarButtons=this.options.toolbarButtons.split(","):t.toolbarButtons=e.wn.richEditorButtons,t.imageStyles=this.options.imageStyles?this.options.imageStyles:{"oc-img-rounded":"Rounded","oc-img-bordered":"Bordered"},t.linkStyles=this.options.linkStyles?this.options.linkStyles:{"oc-link-green":"Green","oc-link-strong":"Thick"},t.paragraphStyles=this.options.paragraphStyles?this.options.paragraphStyles:{"oc-text-gray":"Gray","oc-text-bordered":"Bordered","oc-text-spaced":"Spaced","oc-text-uppercase":"Uppercase"},t.paragraphFormat=this.options.paragraphFormat?this.options.paragraphFormat:{N:"Normal",H1:"Heading 1",H2:"Heading 2",H3:"Heading 3",H4:"Heading 4",PRE:"Code"},t.tableStyles=this.options.tableStyles?this.options.tableStyles:{"oc-dashed-borders":"Dashed Borders","oc-alternate-rows":"Alternate Rows"},t.tableCellStyles=this.options.tableCellStyles?this.options.tableCellStyles:{"oc-cell-highlighted":"Highlighted","oc-cell-thick-border":"Thick"},t.toolbarButtonsMD=t.toolbarButtons,t.toolbarButtonsSM=t.toolbarButtons,t.toolbarButtonsXS=t.toolbarButtons,this.options.allowEmptyTags?(t.htmlAllowedEmptyTags=[],this.options.allowEmptyTags.split(/[\s,]+/).forEach((function(e){var i=e.split(".",2);-1===t.htmlAllowedEmptyTags.indexOf(i[0])&&t.htmlAllowedEmptyTags.push(e)}))):t.htmlAllowedEmptyTags=["textarea","a","iframe","object","video","style","script",".fa",".fr-emoticon",".fr-inner","path","line","hr","i"],t.htmlAllowedTags=this.options.allowTags?this.options.allowTags.split(/[\s,]+/):["a","abbr","address","area","article","aside","audio","b","bdi","bdo","blockquote","br","button","canvas","caption","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meter","nav","noscript","object","ol","optgroup","option","output","p","param","pre","progress","queue","rp","rt","ruby","s","samp","script","style","section","select","small","source","span","strike","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],t.htmlAllowedAttrs=this.options.allowAttributes?this.options.allowAttributes.split(/[\s,]+/):["accept","accept-charset","accesskey","action","align","allowfullscreen","allowtransparency","alt","aria-.*","async","autocomplete","autofocus","autoplay","autosave","background","bgcolor","border","charset","cellpadding","cellspacing","checked","cite","class","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","data","data-.*","datetime","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","frameborder","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","max","maxlength","media","method","min","mozallowfullscreen","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","span","src","srcdoc","srclang","srcset","start","step","summary","spellcheck","style","tabindex","target","title","type","translate","usemap","value","valign","webkitallowfullscreen","width","wrap"],t.htmlDoNotWrapTags=this.options.noWrapTags?this.options.noWrapTags.split(/[\s,]+/):["figure","script","style"],t.htmlRemoveTags=this.options.removeTags?this.options.removeTags.split(/[\s,]+/):["script","style","base"],t.lineBreakerTags=this.options.lineBreakerTags?this.options.lineBreakerTags.split(/[\s,]+/):["figure, table, hr, iframe, form, dl"],t.shortcutsEnabled=["show","bold","italic","underline","indent","outdent","undo","redo"],t.requestHeaders={"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content"),"X-Requested-With":"XMLHttpRequest"};var i=this.$el.closest("form"),o={};i.length>0&&e.each(i.serializeArray(),(function(e,t){o[t.name]=t.value})),t.imageUploadURL=t.fileUploadURL=window.location,t.imageUploadParam=t.fileUploadParam="file_data",t.imageUploadParams=t.fileUploadParams=e.extend(o,{_handler:t.uploadHandler});var n=this.$textarea.attr("placeholder");t.placeholderText=n||"",t.height=this.$el.hasClass("stretch")?1/0:e(".height-indicator",this.$el).height(),this.options.useMediaManager||delete e.FroalaEditor.PLUGINS.mediaManager,e.FroalaEditor.ICON_TEMPLATES={font_awesome:'<i class="icon-[NAME]"></i>',text:'<span style="text-align: center;">[NAME]</span>',image:"<img src=[SRC] alt=[ALT] />"},this.$textarea.on("froalaEditor.initialized",this.proxy(this.build)),this.$textarea.on("froalaEditor.contentChanged",this.proxy(this.onChange)),this.$textarea.on("froalaEditor.html.get",this.proxy(this.onSyncContent)),this.$textarea.on("froalaEditor.html.set",this.proxy(this.onSetContent)),this.$textarea.on("froalaEditor.paste.beforeCleanup",this.proxy(this.beforeCleanupPaste)),this.$form.on("oc.beforeRequest",this.proxy(this.onFormBeforeRequest)),this.$textarea.froalaEditor(t),this.editor=this.$textarea.data("froala.editor"),this.options.readOnly&&this.editor.edit.off(),this.$el.on("keydown",".fr-view figure",this.proxy(this.onFigureKeydown))},o.prototype.dispose=function(){this.unregisterHandlers(),this.$textarea.froalaEditor("destroy"),this.$el.removeData("oc.richEditor"),this.options=null,this.$el=null,this.$textarea=null,this.$form=null,this.editor=null,i.dispose.call(this)},o.prototype.unregisterHandlers=function(){this.$el.off("keydown",".fr-view figure",this.proxy(this.onFigureKeydown)),this.$textarea.off("froalaEditor.initialized",this.proxy(this.build)),this.$textarea.off("froalaEditor.contentChanged",this.proxy(this.onChange)),this.$textarea.off("froalaEditor.html.get",this.proxy(this.onSyncContent)),this.$textarea.off("froalaEditor.html.set",this.proxy(this.onSetContent)),this.$textarea.off("froalaEditor.paste.beforeCleanup",this.proxy(this.beforeCleanupPaste)),this.$form.off("oc.beforeRequest",this.proxy(this.onFormBeforeRequest)),e(window).off("resize",this.proxy(this.updateLayout)),e(window).off("oc.updateUi",this.proxy(this.updateLayout)),this.$el.off("dispose-control",this.proxy(this.dispose))},o.prototype.build=function(t,i){this.updateLayout(),e(window).on("resize",this.proxy(this.updateLayout)),e(window).on("oc.updateUi",this.proxy(this.updateLayout)),i.events.on("keydown",this.proxy(this.onKeydown),!0),this.$textarea.trigger("init.oc.richeditor",[this])},o.prototype.isCodeViewActive=function(){return this.editor&&this.editor.codeView&&this.editor.codeView.isActive()},o.prototype.getElement=function(){return this.$el},o.prototype.getEditor=function(){return this.editor},o.prototype.getTextarea=function(){return this.$textarea},o.prototype.getContent=function(){return this.editor.html.get()},o.prototype.setContent=function(e){this.editor.html.set(e)},o.prototype.syncContent=function(){this.editor.events.trigger("contentChanged")},o.prototype.updateLayout=function(){var t=e(".fr-wrapper",this.$el),i=e(".fr-code",this.$el),o=e(".fr-toolbar",this.$el),n=e(".fr-box",this.$el);if(t.length)if(this.$el.hasClass("stretch")&&!n.hasClass("fr-fullscreen")){var a=o.outerHeight(!0);t.css("top",a+1),i.css("top",a)}else t.css("top",""),i.css("top","")},o.prototype.insertHtml=function(e){this.editor.html.insert(e),this.editor.selection.restore()},o.prototype.insertElement=function(t){this.insertHtml(e("<div />").append(t.clone()).remove().html())},o.prototype.insertUiBlock=function(e){this.$textarea.froalaEditor("figures.insert",e)},o.prototype.insertVideo=function(e,t){this.$textarea.froalaEditor("figures.insertVideo",e,t)},o.prototype.insertAudio=function(e,t){this.$textarea.froalaEditor("figures.insertAudio",e,t)},o.prototype.onSetContent=function(e,t){this.$textarea.trigger("setContent.oc.richeditor",[this])},o.prototype.beforeCleanupPaste=function(e,t,i){return ocSanitize(i)},o.prototype.onSyncContent=function(e,t,i){t.codeBeautifier&&(i=t.codeBeautifier.run(i,t.opts.codeBeautifierOptions));var o={html:i};return this.$textarea.trigger("syncContent.oc.richeditor",[this,o]),o.html},o.prototype.onFocus=function(){this.$el.addClass("editor-focus")},o.prototype.onBlur=function(){this.$el.removeClass("editor-focus")},o.prototype.onFigureKeydown=function(e){this.$textarea.trigger("figureKeydown.oc.richeditor",[e,this])},o.prototype.onKeydown=function(e,t,i){if(this.$textarea.trigger("keydown.oc.richeditor",[i,this]),e.isDefaultPrevented())return!1},o.prototype.onChange=function(e){this.$form.trigger("change")},o.prototype.onFormBeforeRequest=function(e){this.editor&&(this.isCodeViewActive()&&this.editor.html.set(this.editor.codeView.get()),this.$textarea.val(this.editor.html.get()))};var n=e.fn.richEditor;e.fn.richEditor=function(t){var i,n=Array.prototype.slice.call(arguments,1);return this.each((function(){var a=e(this),r=a.data("oc.richEditor"),s=e.extend({},o.DEFAULTS,a.data(),"object"==typeof t&&t);if(r||a.data("oc.richEditor",r=new o(this,s)),"string"==typeof t&&(i=r[t].apply(r,n)),void 0!==i)return!1})),i||this},e.fn.richEditor.Constructor=o,e.fn.richEditor.noConflict=function(){return e.fn.richEditor=n,this},e(document).render((function(){e('[data-control="richeditor"]').richEditor()})),void 0===e.wn&&(e.wn={}),void 0===e.oc&&(e.oc=e.wn),e.wn.richEditorButtons=["paragraphFormat","paragraphStyle","quote","bold","italic","align","formatOL","formatUL","insertTable","insertLink","insertImage","insertVideo","insertAudio","insertFile","insertHR","fullscreen","html"]}(window.jQuery);
